<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:fragment="HeadFrag(title)">
  <meta charset="UTF-8">
  <title th:text="${title}"></title>
  <script th:src="@{/js/lib/jquery-3.6.4.min.js}"></script>
</head>

<body>

<div th:fragment="loginHeadFrag">
	<div class="loginheader">
        <div th:if="${session.loginEmail != null}">
            <span th:text="'안녕하세요, ' + ${session.loginUsersName} + '님!'" style="color:white"></span>
            <a th:href="@{/users/mypage.do}" class="menu-link">마이페이지</a>
            <a th:href="@{/users/logout.do}" class="menu-link">로그아웃</a>
        </div>
        <div th:if="${session.loginEmail == null}">
			<script>
			function openPopup() {
			    var url = "/users/login.html"; 
			    var width = 850; // 팝업 창 너비
			    var height = 700; // 팝업 창 높이
			    var left = (screen.width - width) / 2;
			    var top = (screen.height - height) / 2;
			    var options = "width=" + width + ",height=" + height + ",top=" + top + ",left=" + left;

			    var popupWindow = window.open(url, "Login", options);

			    // 팝업 창이 닫힐 때 이벤트 처리
			    if (popupWindow) {
			        // 부모 창으로부터 데이터 전달 받기
			        window.addEventListener('message', function(event) {
			            if (event.data === 'loginSuccess') {
			                popupWindow.close(); // 팝업 창 닫기
			                // 팝업 창이 닫힌 후에 부모 창에서 필요한 작업 수행
			                location.reload(); // 부모 창 새로고침
			
			            }
			        });
			    }
			}
			</script>
            <button class="Login"  style="background-color: transparent; color: white; border: none; cursor: pointer; font-family: 'GmarketSansMedium';" onclick="openPopup()">로그인</button>
            <a th:href="@{/users/agree.html}" class="menu-link">회원가입</a>
        </div>
    </div>
</div>
</body>
</html>
